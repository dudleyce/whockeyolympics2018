"0","postgame_data <- "
"0","  postgame_data %>%"
"0","  mutate("
"0","    PPGF_home = ifelse((Event == ""Goal"" & `Home Team` == Team & `Home Team Skaters` > `Away Team Skaters` ), TRUE, FALSE) ,"
"0","    PPGF_away = ifelse((Event == ""Goal"" & `Away Team` == Team & `Away Team Skaters` > `Home Team Skaters` ), TRUE, FALSE),"
"0","    PPshots_home = ifelse((Event == ""Shot"" & `Home Team` == Team & `Home Team Skaters` > `Away Team Skaters` ), TRUE, FALSE),"
"0","    PPshots_away =  ifelse((Event == ""Shot"" & `Away Team` == Team & `Away Team Skaters` > `Home Team Skaters` ), TRUE, FALSE),"
"0","    penalties_home = ifelse(Event == ""Penalty Taken"" & `Home Team` == Team, TRUE, FALSE),"
"0","    penalties_away = ifelse(Event == ""Penalty Taken"" & `Away Team` == Team, TRUE, FALSE),"
"0","    PP_recoveries_home = ifelse(`X Coordinate` < 50 & Event == ""Puck Recovery"" &  `Home Team` == Team & `Home Team Skaters` > `Away Team Skaters`, TRUE, FALSE),"
"0","    PP_recoveries_away = ifelse(`X Coordinate` < 50 & Event == ""Puck Recovery"" &  `Away Team` == Team & `Away Team Skaters` > `Home Team Skaters`, TRUE, FALSE)"
"0","  )"
"0",""
"0","game_data_us_can <- "
"0","  postgame_data %>%"
"0","  group_by(game_date, `Home Team`, `Away Team`) %>%"
"0","  summarise("
"0","    HomeGoals = sum(Event == ""Goal"" & `Home Team` == Team),"
"0","    AwayGoals = sum(Event == ""Goal"" & `Away Team` == Team),"
"0","    HomePP_goals = sum(PPGF_home),"
"0","    AwayPP_goals = sum(PPGF_away),"
"0","    HomePP_shots = sum(PPshots_home),"
"0","    AwayPP_shots = sum(PPshots_away),"
"0","    Home_penalties = sum(penalties_home),"
"0","    Away_penalties = sum(penalties_away),"
"0","    Home_recoveries = sum(PP_recoveries_home),"
"0","    Away_recoveries = sum(PP_recoveries_away),"
"0","    .groups = ""drop"")"
"0",""
"0","game_data_us_can <- game_data_us_can %>%"
"0","  mutate("
"0","    Home_opposing_penalties = Away_penalties,"
"0","    Away_opposing_penalties = Home_penalties"
"0","  )"
"0",""
"0","# longer"
"0","long_data_us_can <- game_data_us_can %>%"
"0","  pivot_longer("
"0","    cols = c(HomeGoals, AwayGoals, HomePP_goals, AwayPP_goals, HomePP_shots, AwayPP_shots,"
"0","             Home_recoveries, Away_recoveries,"
"0","             Home_opposing_penalties, Away_opposing_penalties),"
"0","    names_to = c(""Type"", "".value""),"
"0","    names_pattern = ""(Home|Away)(.*)"""
"0","  ) %>% ungroup()"
"0",""
"0","long_data_us_can <- long_data_us_can %>%"
"0","  mutate("
"0","    Team = ifelse(Type == ""Home"", `Home Team`, `Away Team`),"
"0","    Opposing_penalties = ifelse(Type == ""Home"", Away_penalties, Home_penalties)  # Map opposing penalties explicitly"
"0","  ) %>%"
"0","  select(game_date, Team, Goals, PP_goals, Opposing_penalties, PP_shots, `_recoveries`) %>%"
"0","  mutate(Canada = ifelse(Team == ""Olympic (Women) - Canada"", ""Canada"", ""Opponent""))"
"0",""
"0",""
"0","# Calculate power play success percentage"
"0","pp_data <- long_data_us_can %>%"
"0","  mutate("
"0","    PP_success_percentage = ifelse(Opposing_penalties > 0, (PP_goals / Opposing_penalties) * 100, 0)"
"0","  )"
"0",""
"0","pp_data2 <-"
"0","  pp_data %>%"
"0","  group_by(Team) %>%"
"0","  summarise("
"0","    Goals = sum(Goals),"
"0","    PP_goals = sum(PP_goals),"
"0","    Opportunities = sum(Opposing_penalties),"
"0","    PP_shots = sum(PP_shots),"
"0","    recoveries = sum(`_recoveries`)"
"0","    "
"0","    "
"0","  )"
"0",""
"0","pp_data2 <-"
"0","  pp_data2 %>%"
"0","  mutate(Success_Rate = PP_goals / Opportunities,"
"0","         Shots_per_opportunity = PP_shots / Opportunities,"
"0","         Recoveries_per_opportunity = recoveries / Opportunities) %>%"
"0","  arrange(desc(Success_Rate))"
